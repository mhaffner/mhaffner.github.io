<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 3.3.0">
  <meta name="generator" content="Hugo 0.53" />

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Matthew Haffner">

  
  
  
    
  
  <meta name="description" content="Web scraping, text processing, mapping, and exploratory spatial data analysis">

  
  <link rel="alternate" hreflang="en-us" href="/post/osu-fb-recruiting-tech.utf8/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai.min.css" crossorigin="anonymous">
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  

  <link rel="stylesheet" href="/styles.css">
  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-96619934-1', 'auto');
      
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Matthew Haffner">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Matthew Haffner">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/osu-fb-recruiting-tech.utf8/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Matthew Haffner">
  <meta property="og:url" content="/post/osu-fb-recruiting-tech.utf8/">
  <meta property="og:title" content="The geography of Oklahoma State football recruiting: Technical approach | Matthew Haffner">
  <meta property="og:description" content="Web scraping, text processing, mapping, and exploratory spatial data analysis"><meta property="og:image" content="/img/prof-pic-edit.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2019-01-28T13:09:13-06:00">
  
  <meta property="article:modified_time" content="2019-01-28T13:09:13-06:00">
  

  

  

  <title>The geography of Oklahoma State football recruiting: Technical approach | Matthew Haffner</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Matthew Haffner</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#publications_selected">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#talks">
            
            <span>Talks</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#teaching">
            
            <span>Teaching</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/files/cv.pdf">
            
            <span>CV</span>
            
          </a>
        </li>

        
        

      

        

        

        

        

      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">The geography of Oklahoma State football recruiting: Technical approach</h1>

  

  
    


<meta content="2019-01-28 13:09:13 -0600 CST" itemprop="datePublished">
<meta content="2019-01-28 13:09:13 -0600 CST" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Mon, Jan 28, 2019</time>
  </span>
  

  

  
  

  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=The%20geography%20of%20Oklahoma%20State%20football%20recruiting%3a%20Technical%20approach&amp;url=%2fpost%2fosu-fb-recruiting-tech.utf8%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2fosu-fb-recruiting-tech.utf8%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2fosu-fb-recruiting-tech.utf8%2f&amp;title=The%20geography%20of%20Oklahoma%20State%20football%20recruiting%3a%20Technical%20approach"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2fosu-fb-recruiting-tech.utf8%2f&amp;title=The%20geography%20of%20Oklahoma%20State%20football%20recruiting%3a%20Technical%20approach"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=The%20geography%20of%20Oklahoma%20State%20football%20recruiting%3a%20Technical%20approach&amp;body=%2fpost%2fosu-fb-recruiting-tech.utf8%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    















  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      

<h1 id="introduction">Introduction</h1>

<p>In this piece I&rsquo;m going to describe in detail the technical aspects behind a
recent a recent project that I wrote about on the geography of Oklahoma State
football&rsquo;s recruiting practices. This project involves extracting web content,
processing text, geocoding, web mapping, and some basic exploratory spatial data
analysis. I met a number of unexpected challenges along the way and I hope this
will serve to help others facing similar issues. These scripts are also
available in full in a <a href="https://gitlab.com/mhaffner/okstate-fb-recruiting" target="_blank">repository on
GitLab</a>.</p>

<h1 id="extracting-and-processing-text-from-the-web">Extracting and processing text from the web</h1>

<p>Initially I was planning on just using the rosters provided on Oklahoma State&rsquo;s
website, but this proved to be problematic for several reasons: (1) each year&rsquo;s
roster lists every player on the team and does not stratify by signing class;
(2) Oklahoma State&rsquo;s online rosters are only available from 2015 - 2019; (3) and
they use a weird state abbreviation system that doesn&rsquo;t work well with
geocoders. Kyle Porter from Pistol&rsquo;s Firing Blog suggested I try Rivals or 247
Sports, and Rivals had exactly what I was looking for: a list of recruits for
each year dating back to 2002.</p>

<p>In the snippet below I load libraries, set my working directory and extract some
raw data from my GitLab page. These are state (for the U.S.) and province (for
Canada) abbreviations that are matched to abbreviations on Rivals and used to
improve geocoding results.</p>

<pre><code class="language-r">  library(httr)
  library(rjson)
  library(magrittr)
  library(ggmap)
  library(purrr)

  # set working directory
  setwd(&quot;/home/matt/git-repos/okstate-fb-recruiting/data/&quot;)

  # get state abbreviations from the web and convert to data frame
  states.df &lt;- data.frame(read.csv(&quot;https://gitlab.com/mhaffner/useful-files/raw/master/state-abbreviations.csv&quot;,
                                   strip.white = TRUE,
                                   stringsAsFactors = FALSE))
</code></pre>

<p>Even though Rivals contains data on Oklahoma State&rsquo;s rosters back to 2002, I
only use 2006 - 2019 which covers Gundy&rsquo;s tenure as head coach. His first year
was 2005, but his first recruiting class would have been 2006. Conveniently, the
early signing period for 2019 has already occurred, and with OSU&rsquo;s 20
commitments (19 signees and 1 verbal commitment) not much will change on
February 6, National Signing Day.</p>

<pre><code class="language-r">years &lt;- c(2006:2019)
</code></pre>

<p>The next part is a loop broken into multiple chunks for readability. In here
there is some text parsing/processing, geocoding, and aggregation. First, I loop
through every year in the previously declared variable, <code>years</code>, which creates a
link for each signing class with the <code>page</code> variable.</p>

<pre><code class="language-r">for (year in years) {
  page &lt;- paste0(&quot;https://oklahomastate.rivals.com/commitments/Football/&quot;, year)
</code></pre>

<p>What follows is how I turned the web table from rivals into a data frame.
Typically, using a library like <code>rvest</code> is ideal since it can simplify much of
this process using CSS selectors. Unfortunately though, the tables on Rivals are
generated using JavaScript, not created with pure HTML. This is problematic
since the page takes some time to load, and the JavaScript content is
inaccessible with <code>rvest</code> in such circumstances.</p>

<p>There are ways of getting around this that are a bit more involved, but they
require more work up-front (e.g., R packages <code>splashr</code> and <code>RSelenium</code>). For
more long-term projects, these would certainly be more appropriate, but for my
sake, simply extracting all text content from the page and parsing it on the
back end is sufficient since Rivals&rsquo; content is predictable and the tables don&rsquo;t
vary in structure from year to year. I&rsquo;m not sure why a simple <code>GET</code> request
with the <code>httr</code> package works for extracting the JavaScript-created tables but
<code>rvest</code> functions do not:</p>

<pre><code class="language-r">  ### create data frame
  # get the webpage content
  players.df &lt;- GET(page) %&gt;%
    # convert content to text
    content(., &quot;text&quot;) %&gt;%
    # split by the json's front end
    strsplit(., &quot;rv-commitments prospects=&quot;) %&gt;% extract2(1) %&gt;% extract2(2) %&gt;%
    # split by the json's back end
    strsplit(., &quot;&lt;/rv-commitments&quot;) %&gt;% extract2(1) %&gt;% extract2(1) %&gt;%
    # do a little more parsing
    strsplit(., paste0(&quot;sport='football' team-ranking='teamRanking' year='&quot;, year,&quot;'&gt;&quot;)) %&gt;%
    # parse by character position; basically strip out &gt; and &lt;
    substr(., 2, nchar(.)-2) %&gt;%
    # convert from json
    fromJSON() %&gt;%
    # convert NULLs to NA, list items to data frame columns (character and numeric) and create tibble
    map_df(., flatten)
</code></pre>

<p>Here, I make extensive use of the pipe function, <code>%&gt;%</code>, which has become a
staple of mine lately. While it can be a bit confusing at first, it ultimately
makes for much more transparent workflow and cleaner code. In the code above, a
period is frequently used as an argument (e.g., <code>content(., &quot;text&quot;) %&gt;%</code>), which
simply means &ldquo;the thing (or object) from the previous pipe.&rdquo; What was puzzling
to me initially is that with functions where only one argument is required, the
period is not needed, so it is usually omitted (e.g. <code>some_func() %&gt;%</code>).</p>

<p>The pipe also requires some alternative function use, like <code>extract2()</code> used in
place of indexing, which does not work with pipes. Essentially <code>%&gt;% extract2(1)
%&gt;% extract(2)</code> means <code>my_obj[1][2]</code>. Then, the use of <code>strsplit</code> to get what I
needed simply required a bit of trial and error.</p>

<p>Next, I geocoded (i.e. attached geometry to locations based on text) the
players&rsquo; hometowns so that they could be mapped. I was originally using the
<code>nominatim</code> package for this, but it was inappropriate on a few different
levels: (1) it is a bit overkill for the simple purpose of getting cities&rsquo;
latitude/longitude locations; the <code>nominatim</code> package relies on OpenStreetMap
which contains hundreds of different feature types. (2) <code>nominatim</code> requires an
API key and has query limits. While I was not close to hitting the limit in this
project, I very well could hit it in similar projects in the future. (3) While
all geocoders occasionally produce erroneous results, <code>nominatim</code> produced more
errors for me. Given that I only need to geocode city locations and that
precision is not a major concern, <code>ggmap</code> is a better choice.</p>

<p>Even with <code>ggmap</code>, however, it is better to use full state or province names
rather than state abbreviations. Canadian provinces and their abbreviations were
required in addition to U.S. states, since Oklahoma State attracts a wealth of
players from the Great White North. These are matched and assigned using the
<code>match</code> function.</p>

<pre><code class="language-r">  # match results based on table indices
  players.df$state &lt;- states.df$state[match(players.df$state_abbreviation, states.df$abbrev)]

  # create a field of city, state
  players.df$home.town &lt;- paste0(players.df$city, &quot;, &quot;, players.df$state)

  # use ggmap geocoder to get geometry
  home.town.loc &lt;- geocode(players.df$home.town, output = &quot;latlon&quot;, source = &quot;dsk&quot;)

  players.df$lon &lt;- home.town.loc$lon
  players.df$lat &lt;- home.town.loc$lat
</code></pre>

<p>I then create a data frame out of the first year&rsquo;s data and append the rows of
each year&rsquo;s recruits to the previous. This does not feel very efficient or
R-like, but it gets the job done. Note that the apparent mismatched bracket is
paired at the top of the <code>for</code> loop.</p>

<pre><code class="language-r">  # append dataframe rows
  if (year == min(years)){
    agg.df &lt;- players.df
  } else {
    agg.df &lt;- rbind(agg.df, players.df)
  }
}
</code></pre>

<p>Finally, I write the results to a file since the geocoding takes a while and
this only needs to be done once.</p>

<pre><code class="language-r"># save the .csv to a file
write.csv(agg.df, &quot;osu-recruits.csv&quot;, row.names = FALSE)
</code></pre>

<h1 id="mapping-all-recruits">Mapping all recruits</h1>

<p>For this part, some different libraries are needed. In my repository this is
actually the start of a separate script, but for the sake of brevity I omit
redundant lines here (e.g., <code>setwd</code>). The library <code>randomcoloR</code> is used to
assign colors to points, and <code>leaflet</code> is used to create the web maps.</p>

<pre><code class="language-r">library(randomcoloR)
library(leaflet)
</code></pre>

<p>First, I load the data.</p>

<pre><code class="language-r"># load data
recruits &lt;- data.frame(read.csv(&quot;osu-recruits.csv&quot;))
</code></pre>

<p>Next, I create a variable containing the years of the study. Rather than do this
manually with <code>years &lt;- 2006:2019</code>, I simply extract the unique years from the
necessary column in the <code>recruits</code> data frame.</p>

<pre><code class="language-r"># get unique years as a variable
years &lt;- unique(recruits$year)
</code></pre>

<p>Following this, I generate the color scheme used throughout the study. Selecting
14 distinct yet visually appealing colors is surprisingly difficult, but the
<code>randomcoloR</code> library does this quite well. As the name implies, it generates
colors randomly, so I use <code>set.seed(3)</code> to &ldquo;fix&rdquo; the scheme to what I deemed
desirable. I tested other schemes with <code>set.seed(1)</code> and <code>set.seed(2)</code>, but
didn&rsquo;t like these as much. Fixing the color scheme is important since I want to
use the same color scheme in other scripts. I simply use <code>set.seed(3)</code> prior to
the line with the <code>distinctColorPalette</code> function, and this replicates my
desired scheme.</p>

<pre><code class="language-r"># create color palette use the randomcoloR library to generate distinct colors -
# this works betters than functions like &quot;rainbow&quot;
#
# I tried a few different random seeds to get this order - this avoids similarly
# looking colors adjacent to one another (by year)
set.seed(3)
colors &lt;- colorFactor(sample(distinctColorPalette(length(years))),
                      domain = c(min(years):max(years)))
</code></pre>

<p>To create the web maps I use the <code>leaflet</code> package which has great documentation
and is pleasantly intuitive. It blows my mind how much easier it is to create
web maps in R rather using pure html and JavaScript. Plus, using R makes a
wealth of statistical and spatial analysis capabilities available directly, and
frameworks like Shiny and RMarkdown make creating production quality web maps
totally viable. Since discovering this combination of packages, my mind has been
reeling with potential applications.</p>

<p>Creating web maps is another place where using pipes makes sense, since each
line adds something new to the map &ndash; sort of like creating a layer in a desktop
GIS &ndash; and avoids having to repeatedly declare a <code>map</code> variable. The code below
creates a simple base map with the view fixed in a location that makes all data
points visible. I use Stamen&rsquo;s Toner tiles (as opposed to the default Open
Street Map tiles) which use only black to avoid conflicts with the 14 different
colors of the points.</p>

<pre><code class="language-r">map &lt;- leaflet(width = &quot;100%&quot;, height = &quot;650px&quot;) %&gt;%
  addProviderTiles(providers$Stamen.Toner) %&gt;%
  setView(lng = -98.33, lat = 38.37, zoom = 4)
</code></pre>

<p>Following this, I use a loop (solution found on Stack Overflow) to
create a separate layer for each year. This is only necessary since I
am using <code>overlayGroups</code> to create selectable layers. I make some
modifications to the default styles like lowering the opacity to give
a sense of density. Using an even lower opacity (e.g., <code>0.2</code>) does
this better but makes distinguishing colors more difficult. If the
point of this project was to show hotbeds of recruits over Gundy&rsquo;s
entire tenure (i.e. not from year to year), something like kernel
density estimation would certainly be a better visualization tool.</p>

<pre><code class="language-r">for (year in years) {
  data &lt;- recruits[recruits$year == year,]
  map &lt;- map %&gt;%
    addCircleMarkers(data = data,
                     lng = ~lon,
                     lat = ~lat,
                     radius = 7,
                     stroke = FALSE,
                     color = ~colors(year),
                     fillOpacity = 0.8,
                     group = as.character(year))
  }
</code></pre>

<p>Even with this code above, the map is still not displayed. This final
snippet displays the map, adds layer control, and adds a legend.</p>

<pre><code class="language-r">map %&gt;%
  addLayersControl(
    overlayGroups = years,
    options = layersControlOptions(collapsed = TRUE)) %&gt;%
    addLegend(&quot;bottomleft&quot;, pal = colors, values = years, opacity = 1)
</code></pre>

<p><div style="text-align: center;"></p>

<h3 id="recruits-hometowns-2006-2019">Recruits&rsquo; hometowns (2006 - 2019)</h3>

<p></div>
preserve217ff3702ccfe00e</p>

<p>Originally I used popup markers so that you could click on a point and
see the player&rsquo;s name and hometown, but since multiple players can
come from the same town, there are many overlapping points. From what
I can see, Leaflet has no effective way of handling these, and you can
only click on the top point. I was a bit confused before I realized
this - clicking on Tulsa, I did see Justice Hill, for instance. To
avoid confusion I just omitted this feature.</p>

<h1 id="measures-of-central-tendency-and-dispersion">Measures of central tendency and dispersion</h1>

<p>Though this web map is fun to play around with, it does not tell us
anything definitive about patterns over time. Humans are notoriously
bad at detecting spatial patterns visually, which works out well for
me as it provides job security. Due this, I use several metrics: mean
center, median center, and standard deviation.</p>

<h2 id="mean-centers">Mean centers</h2>

<p>The mean center is a straightforward measure that simply averages the
longitude and latitude values (separately, of course). Using a
geographic coordinate system always necessitates caution, since
distance calculations often don&rsquo;t work as intended &ndash; a degree of
latitude and a degree of longitude are unequal except at the equator.
In this case, however, the latitude and longitude means are calculated
separately, so this conniption does not pose any problems.</p>

<pre><code class="language-r">  # get the mean center for each year
  mean.centers &lt;- data.frame(year = years, lon = NA, lat = NA)

  for (year in years) {
    mean.centers$lon[mean.centers$year == year] &lt;- mean(recruits$lon[recruits$year == year])
    mean.centers$lat[mean.centers$year == year] &lt;- mean(recruits$lat[recruits$year == year])
  }
</code></pre>

<p>This time I set the view programmatically based on the data&rsquo;s mean
center. Yet, this cuts off view of the year 2016 which lies farther
north than any other point, so I add <code>0.4</code> to the starting latitude
view. I use the same color scheme as before, but I leave the opacity
alone since there are no overlapping points.</p>

<pre><code class="language-r">  # create map of mean centers
  leaflet(width = &quot;100%&quot;, height = &quot;500px&quot;) %&gt;%
    addTiles() %&gt;%
    setView(lng = mean(mean.centers$lon), lat = mean(mean.centers$lat)+0.4, zoom = 7) %&gt;%
    addCircleMarkers(data = mean.centers,
                     lng = ~lon,
                     lat = ~lat,
                     label = ~as.character(year),
                     labelOptions = labelOptions(noHide = TRUE,
                                                 direction = &quot;bottomleft&quot;),
                     radius = 7,
                     stroke = FALSE,
                     color = ~colors(year),
                     fillOpacity = 1)
</code></pre>

<p><div style="text-align: center;"></p>

<h3 id="mean-centers-of-recruits-hometowns-2006-2019">Mean centers of recruits&rsquo; hometowns (2006 - 2019)</h3>

<p></div>
preservedd2130b47a74291f</p>

<h2 id="median-centers">Median centers</h2>

<p>Due to the intermittent recruits from California, the Northeast, and
Canada &ndash; Chuba Hubbard&rsquo;s hometown, for example, lies at a whopping
53.5 degrees north &ndash; mapping the median center is a good idea as this
metric reduces the influence of outliers. This code is identical to
the previous except that it calculates medians instead of means. I
still use the mean center (plus the same minor correction mentioned
earlier) to generate the starting view so that the two are consistent.</p>

<pre><code class="language-r"># get median center for each year
median.centers &lt;- data.frame(year = years, lon = NA, lat = NA)

for (year in years) {
  median.centers$lon[median.centers$year == year] &lt;- median(recruits$lon[recruits$year == year])
  median.centers$lat[median.centers$year == year] &lt;- median(recruits$lat[recruits$year == year])
}

leaflet(width = &quot;100%&quot;, height = &quot;500px&quot;) %&gt;%
  addTiles() %&gt;%
  setView(lng = mean(mean.centers$lon), lat = mean(mean.centers$lat)+0.4, zoom = 7) %&gt;%
  addCircleMarkers(data = median.centers,
                   lng = ~lon,
                   lat = ~lat,
                   label = ~as.character(year),
                   labelOptions = labelOptions(noHide = TRUE,
                                               direction = &quot;bottomleft&quot;),
                   radius = 7,
                   stroke = FALSE,
                   color = ~colors(year),
                   fillOpacity = 1)
</code></pre>

<p><div style="text-align: center;"></p>

<h3 id="median-centers-of-recruits-hometowns-2006-2019">Median centers of recruits&rsquo; hometowns (2006 - 2019)</h3>

<p></div>
preserveb514b7c0b2163ece</p>

<h2 id="dispersion">Dispersion</h2>

<p>Using the median significantly reduces the amount of east-west variability and
makes 2009 and 2016 stand out from the other years. However, this approach does
not consider dispersion. If Oklahoma State received all of its recruits from
Dallas during one year and zero recruits from Dallas during another year, the
two <em>could</em> still have the exact same mean or median center. I compare standard
deviation of distance from Stillwater by year in a later chart, but I thought it
would be useful to visualize dispersion by creating lines from Stillwater to
every recruits&rsquo; hometown.</p>

<p>This process also requires some different libraries, particularly for creating
lines (e.g., the <code>st_cast</code> function from <code>sf</code>) and converting units
(<code>udunits2</code>). Advantageously, this approach displays both distance and direction
from Stillwater. It should be noted that the <code>sf</code> library utilizes geodetic
distance by default when a geographic coordinate system is used.</p>

<pre><code class="language-r">  library(sp)
  library(sf)
  library(udunits2)

  multipoints &lt;- st_multipoint(as.matrix(recruits[,c(&quot;lon&quot;, &quot;lat&quot;)]))
  points &lt;- st_cast(st_geometry(multipoints), &quot;POINT&quot;)

  # create point for just stillwater
  stillwater &lt;- st_geometry(st_point(c(-97.0665, 36.1257)))
  st_crs(stillwater)  &lt;- &quot;+init=epsg:4326&quot;


  for (k in years) {
    multipoints &lt;- st_multipoint(as.matrix(recruits[,c(&quot;lon&quot;, &quot;lat&quot;)][recruits$year == k,]))
    points &lt;- st_cast(st_geometry(multipoints), &quot;POINT&quot;)
    st_crs(points)  &lt;- &quot;+init=epsg:4326&quot;

    for (i in 1:length(points)) {
      # combine each point with stillwater to make a pair of points
      pair &lt;- st_combine(c(points[i], stillwater))
      dist &lt;- st_distance(points[i], stillwater) %&gt;%
        # convert from meters to miles
        ud.convert(., &quot;m&quot;, &quot;mi&quot;)

      # create a line from this pair of points
      line &lt;- st_cast(pair, &quot;LINESTRING&quot;)

      # combine lines into multilinestring for plotting and combine distances
      # together for computations
      if (i == 1) {
        lines &lt;- line
        distances &lt;- dist
      } else {
        lines &lt;- st_combine(c(lines, line))
        distances &lt;- append(distances, dist)
      }
    }

    ### distances ###
    # append to dataframe
    if (k == min(years)) {
      dist.df &lt;- data.frame(distance = as.numeric(distances), year = k)
    } else {
      tmp.df &lt;- data.frame(distance = as.numeric(distances), year = k)
      dist.df &lt;- rbind(dist.df, tmp.df)
    }

    ### lines ###
    # covert to sp object
    lines.sldf &lt;- sf:::as_Spatial(lines)

    # assign year to column
    lines.sldf$year &lt;- k

    if (k == min(years)) {
      lines.all &lt;- lines.sldf
    } else {
      lines.all &lt;- rbind(lines.all, lines.sldf)
    }
  }

  # set colors
  set.seed(3)
  colors &lt;- sample(distinctColorPalette(length(years)))

  # set up plot space
  par(mfrow=c(5,3))
  par(mar = c(2,2,2,2))

  # plot lines, each on a separate space
  for (i in 1:length(lines.all$year)) {
    plot(lines.all[lines.all$year == lines.all$year[i],],
         col = colors[i])
         #xlim = c(bbox(lines.all)[1],bbox(lines.all)[2]), # this looks really weird
         #ylim = c(bbox(lines.all)[3],bbox(lines.all)[4]))
    title(years[i])
  }
</code></pre>

<p><div style="text-align: center;"></p>

<h3 id="distance-and-direction-of-recruits-hometowns-to-stillwater">Distance and direction of recruits&rsquo; hometowns to Stillwater</h3>

<p></div>
<img src="osu-fb-recruiting-tech_files/figure-html/unnamed-chunk-22-1.png" width="100%" /></p>

<p>One problem incurred here is that the scale is not consistent from plot to plot.
This makes it look as though the distance from Stillwater is low in 2014, when
in reality its standard deviation is low but its median distance from Stillwater
is <em>the greatest in the entire set</em>. Due to this, I think it&rsquo;s useful to
visualize mean distance, median distance, and standard deviation on a line graph
as well. There were some weird formatting issues with the image, so I saved it
as a .png instead of rendering it within the .Rmd directly.</p>

<pre><code class="language-r"># create vectors of means, medians, and standard deviation by year
mean.dist &lt;- tapply(dist.df$distance, dist.df$year, mean)
median.dist &lt;- tapply(dist.df$distance, dist.df$year, median)
sd.dist &lt;- tapply(dist.df$distance, dist.df$year, sd)

# create data frame of these three vectors
summary.df &lt;- data.frame(mean = mean.dist,
                         median = median.dist,
                         sd = sd.dist)

png(&quot;../img/summary.png&quot;,
    width = 800,
    height = 800,
    units = &quot;px&quot;,
    res = 110)
plot.new()
par(mfrow=c(3,1))
par(mar = c(4,4,4,4))

# plot for mean
plot(summary.df$mean,
     type = &quot;l&quot;,
     xlab = &quot;&quot;,
     ylab = &quot;Distance (miles)&quot;,
     xaxt = &quot;n&quot;, # remove xaxis labels; add them in the next line
     xaxs = &quot;i&quot;) # remove excess space in the plot
title(&quot;Mean distance from Stillwater&quot;)
labs &lt;- years
axis(side=1, labels=labs, at=c(1:length(years)))

# plot for median
plot(summary.df$median,
     type = &quot;l&quot;,
     xlab = &quot;&quot;,
     ylab = &quot;Distance (miles)&quot;,
     xaxt = &quot;n&quot;, # remove xaxis labels; add them in the next line
     xaxs = &quot;i&quot;) # remove excess space in the plot
title(&quot;Median distance from Stillwater&quot;)
labs &lt;- years
axis(side=1, labels=labs, at=c(1:length(years)))

# plot for standard deviation
plot(summary.df$sd,
     type = &quot;l&quot;,
     xlab = &quot;&quot;,
     ylab = &quot;Distance (miles)&quot;,
     xaxt = &quot;n&quot;, # remove xaxis labels; add them in the next line
     xaxs = &quot;i&quot;) # remove excess space in the plot
title(&quot;Standard deviation of distance from Stillwater&quot;)
labs &lt;- years
axis(side=1, labels=labs, at=c(1:length(years)))
dev.off()
</code></pre>

<p><div style="text-align: center;"></p>

<h3 id="mean-median-and-standard-deviation-of-recruits-distance-from-stillwater">Mean, median, and standard deviation of recruits&rsquo; distance from Stillwater</h3>

<p></div>
<img src="https://gitlab.com/mhaffner/okstate-fb-recruiting/raw/master/img/summary.png" width="100%" /></p>

<p>From these, it&rsquo;s difficult to see any meaningful trend in the data.
While 14 years as a head coach is a long time in the world of NCAA
football, from a statistical perspective it&rsquo;s not a large sample size.
It would be nice to examine trends with more data from the past, but
Rivals only reaches back to 2002.</p>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/spatial-statistics/">Spatial statistics</a>
  
  <a class="badge badge-light" href="/tags/geography/">geography</a>
  
  <a class="badge badge-light" href="/tags/web-scraping/">web scraping</a>
  
  <a class="badge badge-light" href="/tags/web-mapping/">web mapping</a>
  
  <a class="badge badge-light" href="/tags/leaflet/">Leaflet</a>
  
  <a class="badge badge-light" href="/tags/r/">R</a>
  
</div>




    
      






  







<div class="media author-card" itemscope itemtype="http://schema.org/Person">
  
  
  <img class="portrait mr-3" src="/author/admin/avatar_hua142dc9e239def007cc554667d91657f_148683_250x250_fill_q75_box_center.jpg" itemprop="image" alt="Avatar">
  

  <div class="media-body">
    <h5 class="card-title" itemprop="name"><a href="/authors/admin">Matthew Haffner</a></h5>
    <h6 class="card-subtitle">Assistant Professor - Department of Geography and Anthropology</h6>
    
    <ul class="network-icon" aria-hidden="true">
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="/#contact" >
          <i class="fas fa-envelope"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://twitter.com/geo_haffner" target="_blank" rel="noopener">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
      
      
      
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://scholar.google.co.uk/citations?hl=en&amp;user=as6Av2sAAAAJ&amp;view_op=list_works" target="_blank" rel="noopener">
          <i class="ai ai-google-scholar"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="//gitlab.com/mhaffner" >
          <i class="fab fa-gitlab"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://github.com/mhaffner" target="_blank" rel="noopener">
          <i class="fab fa-github"></i>
        </a>
      </li>
      
      
      
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="/files/cv.pdf" >
          <i class="ai ai-cv"></i>
        </a>
      </li>
      
    </ul>
  </div>
</div>



      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/post/osu-fb-recruiting-tech.knit/">The geography of Oklahoma State football recruiting: Technical approach</a></li>
          
          <li><a href="/draft/osu-fb-recruiting/">The geography of Oklahoma State football recruiting</a></li>
          
        </ul>
      </div>
      
    

    

    
<section id="comments">
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "mhaffner" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



  </div>
</article>

<div class="container">
  <footer class="site-footer">
  

  <p class="powered-by">
    2018 Matthew Haffner &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/lisp.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js"></script>
        
      

      
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    

    
    

    
    

    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.546d82170f310ecadabf6df91fb59927.js"></script>

  </body>
</html>

